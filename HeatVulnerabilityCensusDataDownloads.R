#### This is a script to download data at the census tract level from the 2023 American Community Survey
#### Step 1. Call the libraries that we need to use for this script
library(installr)
updateR()
library(tidycensus)
library(tidyr)
library(purrr)
library(tidyverse)


#### Step 2. Access the census data using the API
census_api_key("dea3b495c492dd9cce83e0efd5acd3e2cdaa1cd0", install = TRUE, overwrite = TRUE)

readRenviron("~/.Renviron")

Sys.getenv("CENSUS_API_KEY")
acs_2020_vars <- load_variables(year = 2019,
                                "acs5",
                                cache = TRUE)

### Step 3. Set the working directory and create a list of the variables related to heat vulnerability
setwd("C:/Users/18159/Documents/Illinois Heat Vulnerability/InputDataACS/CensusTracts")

HV_variables <- c("DP05_0001E", "DP05_0005E", "DP05_0024E", 
              "DP05_0072E", "DP05_0073E", "DP05_0079E", 
              "DP05_0080E", "DP05_0081E", "DP05_0082E", 
              "DP05_0083E", "DP05_0084E", "DP05_0085E")

### Step 4. Create a spreadsheet with the selected variables
heat_vulnerability <- get_acs(
  geography = "county",
  variables = HV_variables,
  state = "IL",
  geometry = FALSE,
  year = 2019,
  output = "wide"
)

### Step 5. Export as spreadsheet
write.csv(heat_vulnerability, "MergedACS5Y2019_ILcounties.csv")

